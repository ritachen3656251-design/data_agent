# 多轮对话评估

运行：`python run_eval_multiturn.py`（模拟 session）或 `python run_eval_multiturn.py --full`（真实 answer+session，需 DB）

---

## 评估维度

| 指标 | 说明 |
|------|------|
| **上下文保持正确率** | 后续轮是否正确沿用上一轮的 dt/days 等，assumptions 是否含「沿用上一轮」 |
| **对话偏差正确率** | 多轮间 dt/days 是否一致，是否存在前后矛盾 |

---

## 用例设计

| ID | 场景 | 轮次 | 上下文传递 |
|----|------|------|------------|
| MT01 | 核心指标→原因分析 | T1: 2017-12-03 核心指标 / T2: 为什么下降？ | T2 沿用 last_dt=2017-12-03 |
| MT02 | 趋势→原因 | T1: 最近9天核心指标趋势 / T2: 怎么回事 | T2 沿用 last_days=9 |
| MT03 | 单日指标→类目归因 | T1: 12月3日核心指标 / T2: 哪些类目导致下降？ | T2 沿用 last_dt=2017-12-03 |
| MT04 | 漏斗→诊断 | T1: 最近7天漏斗表现 / T2: 转化率下降原因 | T2 沿用 last_days=7 |
| MT05 | 三连问 | T1: 12月2日核心指标 / T2: 类目贡献 / T3: 为什么下降 | T2、T3 均沿用 last_dt=2017-12-02 |
| MT06 | 双日对比→为什么上升 | T1: 11月25日 / T2: 11月26日 / T3: 为什么上升 | T3 用 last_dt=11/26、prev_dt=11/25 |
| MT07 | 双日→显式对比 | T1: 11月25日 / T2: 12月3日 / T3: 对比这两天 | T3 用 last_dt=12/3、prev_dt=11/25 |
| MT08 | A日指标→B日不同指标→对比 | T1: 11月25日核心指标 / T2: 12月3日类目贡献 / T3: 对比一下 | 暴露跨指标对比的上下文能力 |
| MT09 | 指代不消失-那天 | T1: 12月3日核心指标 / T2: 那天转化率怎么样 | T2 沿用 last_dt=2017-12-03 |
| MT10 | 指代不消失-它 | T1: 最近7天漏斗表现 / T2: 它表现如何 | T2 沿用 last_days=7 |

---

## 偏差检查

- **date_consistency**：各轮使用的 dt 应一致
- **days_consistency**：各轮使用的 days 应一致

若 T1 问「12月3日核心指标」，T2 问「为什么下降」且未指定日期，则 T2 必须使用 dt=2017-12-03，不得使用其他日期。
